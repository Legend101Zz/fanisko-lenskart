import{Utilis as e}from"./utilis.js";import{UIUtilis as t}from"./UIutilis.js";let photoQuality=1,photoMimeType="image/jpeg",vidoMimeType=null,storeBlob=null,videoPreView=null,mediaRecorder=null,frameCount,chunks=[],utilis=new e(5,"./assets/audios/clock.wav","./assets/audios/camera-shutter.mp3","./assets/audios/camera-recdone.mp3",photoMimeType,1),uIutilis=new t,waterMarkerImageUrl="",waterMarker=null,waterMarkerPosition="left",selectionType="photo",contentType="",isDownload="0",isShare="0",currentExperience="",mindarThree,arType,arAssetPath,arAnchorIndex,canvasHeight=1920,canvasWidth=1080,frameRate=30,cameraStream=null,videoStreamBufferData=null,imageCaptureTime=0,positionMarkerImageUrl="",positionIndicator=null,selfieImageUrl="",selfieImage=null,ssvideoPlayer=null,imageCaptureFlag=!1,constraints={audio:!1,video:{facingMode:"user",width:{min:640,ideal:1280,max:1920},height:{min:480,ideal:720,max:1080}}},min=0,sec=0,mobileOS="",ismobile=!1,downloadMsgAndroidVideo="Video Downloaded. Please view it in the gallery",downloadMsgiOSVideo="View your downloaded video in the Files app",downloadMsgAndroidPhoto="Photo Downloaded. Please view it in the gallery",downloadMsgiOSPhoto="View your downloaded photo in the Files app",JWT,experience,otpInput="",log_parameter="",format="",otpEntered="",userSelectedTeam="",isJioUser,analyticsEnv="prod",base_api_endpoint="https://prodapi.jiovipbox.com/",dataLayeraddon={app_name:"ipl2023_vip",env:analyticsEnv,platform:"browser"};function UIdesktopAlert(){document.querySelector("#app").innerHTML=`
        <div class="desktop-alert-title">
            You must be on a mobile device to use this experience
        </div>
    `}function showSnackbar(){var e=document.getElementById("downloadedMsg");e.className="show",setTimeout(function(){e.className=e.className.replace("show","")},5e3)}function selection(){let e=document.getElementById("select--photo--btn"),t=document.getElementById("select--video--btn");"photo"==selectionType&&(e.style.borderBottom="3px solid #FFF",t.style.borderBottom="none",e.style.color="#d9008d",t.style.color="#FFF",document.getElementById("video-img").style.display="none",document.getElementById("camera-img").style.display="block"),"video"==selectionType&&(e.style.borderBottom="none",t.style.borderBottom="3px solid #FFF",t.style.color="#d9008d",e.style.color="#FFF",document.getElementById("video-img").style.display="block",document.getElementById("camera-img").style.display="none")}async function mobileDetection(){navigator.userAgent.match(/Android/i)&&(mobileOS="Android",ismobile=!0),navigator.userAgent.match(/iPhone/i)&&(mobileOS="iOS",ismobile=!0),navigator.userAgent.match(/iPad/i)&&(mobileOS="iOS",ismobile=!0),navigator.userAgent.match(/iPod/i)&&(mobileOS="iOS",ismobile=!0),navigator.userAgent.match(/webOS/i)&&(mobileOS="Web",ismobile=!0)}function getPlatformInfo(){try{console.log(platform.os),console.log(platform.name),console.log(platform.version),console.log(platform.product),console.log(platform.manufacturer),console.log(platform.layout),console.log(platform.description)}catch(e){console.log("err:"+e.message)}}function addselectionButtonEventListener(){document.getElementById("select--photo--btn").addEventListener("click",()=>{console.log("photo --> Selected"),selectionType="photo",selection()}),"Android"!=mobileOS&&document.getElementById("select--video--btn").addEventListener("click",()=>{console.log("video --> Selected"),selectionType="video",selection()})}function addCaptureButtonEventListener(){document.getElementById("capture--btn").addEventListener("click",async()=>{if(console.log("captureBtn --> Clicked"),console.log(`selectionType --> ${selectionType} 
contentType --> ${contentType}`),"photo"==selectionType){let e={event:"select_option",page_title:"squad_selfie_record_video_page",match:userSelectedTeam,message:"capture"},t=Object.assign({},dataLayeraddon,e);try{dataLayer.push(t)}catch(o){console.log(o)}var a={url:base_api_endpoint+"log",method:"POST",timeout:0,headers:{"Content-Type":"application/json",Authorization:JWT},data:JSON.stringify({programName:"vip_lounge",flag:"squad_selfie_page",sqId:"capture_photo",teamId:userSelectedTeam,platform:"browser",parameters:{item:"image"}})};$.ajax(a).done(function(e){console.log(e)}),"ss"==contentType&&utilis.countDown("countdown--view",function(e){console.log(e),imageCaptureFlag=!0,ssvideoPlayer.currentTime=0,ssvideoPlayer.muted=!0,ssvideoPlayer.autoplay=!0,ssvideoPlayer.play()})}else{var a={url:base_api_endpoint+"log",method:"POST",timeout:0,headers:{"Content-Type":"application/json",Authorization:JWT},data:JSON.stringify({programName:"vip_lounge",flag:"squad_selfie_page",sqId:"start_video",teamId:userSelectedTeam,platform:"browser",parameters:{item:"video"}})};$.ajax(a).done(function(e){console.log(e)}),utilis.countDown("countdown--view",function(e){console.log(e),startRecording()})}})}function videoRecorder(){let e=null;"ss"==contentType&&(e=SSrenderCanvas()),(mediaRecorder=new MediaRecorder(e.captureStream(30),{mimeType:vidoMimeType})).start(100),console.log("recording --> Started"),mediaRecorder.onstop=function(e){console.log("data available after MediaRecorder.stop() called."),'video/mp4; codecs="avc1.42E01E, mp4a.40.2"'==vidoMimeType?(storeBlob=videoPreView=new Blob(chunks,{type:"video/mp4"}),chunks=[],previewUIupdate()):(storeBlob=videoPreView=new Blob(chunks,{type:vidoMimeType}),chunks=[],convertWebmtomp4()),console.log("recording -->  Completed")},mediaRecorder.ondataavailable=function(e){chunks.push(e.data)},"ss"==contentType?(ssvideoPlayer.currentTime=0,ssvideoPlayer.muted=!0,ssvideoPlayer.autoplay=!0,ssvideoPlayer.play()):setTimeout(function(){stopRecording()},1e4)}function convertWebmtomp4(){for(var e=0,t=Promise.resolve(),o=e=>{t=t.then(()=>new Promise(t=>$("#load-perc").text(e+"%").delay(1e3).fadeIn("slow",t)))};e<100;)o(e+1),e++;document.querySelector("#load--view").style.display="block",document.querySelector("#load--view").innerHTML=`<img style="width: 100%;" src="./assets/images/squad_selfie_loader.gif" />
    <div class="loader-percent">
        <img class="loading-svg" src="./assets/images/loading.svg" />
        <p id="load-perc"></p>
    </div>`,utilis.convertStreamstoMp4(storeBlob).then((e,t)=>{null!=e&&(storeBlob=e,vidoMimeType="video/mp4",document.querySelector("#load--view").style.display="none",previewUIupdate()),null!=t&&console.log("onRejected"+t)})}function startRecording(){document.getElementById("show-1").style.display="none",document.getElementById("rec-show").style.display="flex";let e={event:"select_option",page_title:"squad_selfie_record_video_page",match:userSelectedTeam,message:"start"},t=Object.assign({},dataLayeraddon,e);try{dataLayer.push(t)}catch(o){console.log(o)}videoRecorder()}function stopRecording(){null!=mediaRecorder&&(mediaRecorder.stop(),window.cancelAnimationFrame(frameCount),frameCount=void 0,min=0,sec=0,document.getElementById("rec-show").style.display="none",console.log("recorder --> Stopped"))}function SSrenderCanvas(){let e=document.getElementById("camera--view"),t=document.getElementById("video--player"),o=document.createElement("canvas"),a=document.getElementById("watermark");return function i(){o.width=1080,o.height=1920;o.getContext("2d").clearRect(0,0,o.width,o.width),utilis.drawCameraView(o,e,constraints.video.facingMode),utilis.drawVideoPlayer(o,t),utilis.drawWatermarkView(o,a,waterMarkerPosition),frameCount=window.requestAnimationFrame(i);document.getElementById("video-time-1").innerHTML="00 : 0"+min,++sec>=60&&(sec=0,min++)}(),o}function previewUIupdate(){if(null!=videoPreView){let e=URL.createObjectURL(videoPreView);if("photo"==selectionType){var t={url:base_api_endpoint+"log",method:"POST",timeout:0,headers:{"Content-Type":"application/json",Authorization:JWT},data:JSON.stringify({programName:"vip_lounge",flag:"squad_selfie_page",sqId:"preview_page",teamId:userSelectedTeam,platform:"browser",parameters:{item:"image"}})};$.ajax(t).done(function(e){console.log(e)}),utilis.playCaptureSound();let o={event:"pageload",page_title:"squad_selfie_video_generated_page",match:userSelectedTeam},a=Object.assign({},dataLayeraddon,o);try{dataLayer.push(a)}catch(i){console.log(i)}document.querySelector("#preview--video").style.display="none";let n=document.querySelector("#preview--image");n.src=e,n.style.display="block"}if("video"==selectionType){var t={url:base_api_endpoint+"log",method:"POST",timeout:0,headers:{"Content-Type":"application/json",Authorization:JWT},data:JSON.stringify({programName:"vip_lounge",flag:"squad_selfie_page",sqId:"preview_page",teamId:userSelectedTeam,platform:"browser",parameters:{item:"video"}})};$.ajax(t).done(function(e){console.log(e)}),utilis.playRecDoneSound();let l={event:"pageload",page_title:"squad_selfie_video_generated_page",match:userSelectedTeam},r=Object.assign({},dataLayeraddon,l);try{dataLayer.push(r)}catch(s){console.log(s)}document.querySelector("#preview--image").style.display="none";let d=document.querySelector("#preview--video");d.src=e,d.play(),d.style.display="block"}document.querySelector("#preview--view").style.display="block",document.querySelector("#camera--panel--view").style.display="none",null!=ssvideoPlayer&&(ssvideoPlayer.currentTime=0,ssvideoPlayer.pause())}}function addShareDownloadButtonEventListener(){document.getElementById("share--btn").addEventListener("click",()=>{let e={event:"select_option",page_title:"squad_selfie_video_generated_page",match:userSelectedTeam,message:"share"},t=Object.assign({},dataLayeraddon,e);try{dataLayer.push(t)}catch(o){console.log(o)}"photo"==selectionType&&(format="image"),"video"==selectionType&&(format="video");var a={url:base_api_endpoint+"log",method:"POST",timeout:0,headers:{"Content-Type":"application/json",Authorization:JWT},data:JSON.stringify({programName:"vip_lounge",flag:"squad_selfie_page",sqId:"share",teamId:userSelectedTeam,platform:"browser",parameters:{item:format}})};if($.ajax(a).done(function(e){console.log(e)}),console.log("shareBtn --> Clicked"),currentExperience="share","0"==isShare){if(!1==isJioUser){document.getElementById("mobilePort").style.display="block",document.getElementById("stepOne").style.display="block",document.getElementById("stepTwo").style.display="none",document.querySelector("#preview--video").style.opacity="0.1";let i={event:"pageload",page_title:"ss_gold_pass_enter_number_page",match:userSelectedTeam},n=Object.assign({},dataLayeraddon,i);try{dataLayer.push(n)}catch(l){console.log(l)}var a={url:base_api_endpoint+"log",method:"POST",timeout:0,headers:{"Content-Type":"application/json",Authorization:JWT},data:JSON.stringify({programName:"vip_lounge",flag:"ss_gold_pass_pop_up",sqId:"pageload",teamId:userSelectedTeam,platform:"browser",parameters:{item:format}})};$.ajax(a).done(function(e){console.log(e)})}else utilis.shareDownload(storeBlob,selectionType,photoMimeType,vidoMimeType,"share")}else null!=storeBlob&&utilis.shareDownload(storeBlob,selectionType,photoMimeType,vidoMimeType,"share")});var e=document.querySelector("[name=mobile-no-user]");e.oninput=function(t){$(".error-success-msg").hide(),10===e.value.length?(console.log("btn--enable"),document.getElementById("proceed").classList.remove("disabled")):console.log("btn--disable")},document.querySelector("#proceed").addEventListener("click",()=>{let e={event:"proceed",page_title:"ss_gold_pass_enter_number_page",match:userSelectedTeam},t=Object.assign({},dataLayeraddon,e);try{dataLayer.push(t)}catch(o){console.log(o)}var a=document.getElementById("user_mobileno").value,i={url:base_api_endpoint+"log",method:"POST",timeout:0,headers:{"Content-Type":"application/json",Authorization:JWT},data:JSON.stringify({programName:"vip_lounge",flag:"ss_gold_pass_pop_up",sqId:"proceed",teamId:userSelectedTeam,platform:"browser",parameters:""})};$.ajax(i).done(function(e){console.log(e)});var i={url:base_api_endpoint+"verifynumber",method:"POST",timeout:0,headers:{Authorization:JWT,"Content-Type":"application/json"},data:JSON.stringify({channelID:"20",serviceIdentifier:[a]})};$.ajax(i).done(function(e){if(console.log(e),"1"==e.isValidJioNumber){var t={url:base_api_endpoint+"login/getotp",method:"POST",timeout:0,headers:{"Content-Type":"application/json"},data:JSON.stringify({phoneNo:a})};$.ajax(t).done(function(e){if(console.log(e),200==e.customCode&&!0==e.success){let t=a.replace(/\d(?=\d{2})/g,"*");console.log(t),document.getElementById("masked_mobile").innerHTML=t,localStorage.setItem("correlationId",e.correlationId),document.getElementById("success-otp").style.display="block",document.getElementById("stepOne").style.display="none",document.getElementById("stepTwo").style.display="block";let o={event:"pageload",page_title:"ss_gold_pass_enter_otp_page",match:userSelectedTeam},i=Object.assign({},dataLayeraddon,o);try{dataLayer.push(i)}catch(n){console.log(n)}}else 400==e.customCode?(document.getElementById("error-no-jio-exhaust").style.display="block",$("#error-no-jio-exhaust").delay(5e3).fadeOut("slow")):(document.getElementById("error-no-jio-somethingwrong").style.display="block",document.getElementById("error-msg").innerHTML=e.message,$("#error-no-jio-somethingwrong").delay(5e3).fadeOut("slow"))}).fail(function(e,t,o){401==e.status?(window.location.href=window.location.origin,console.log("Unauthorized")):(window.location.href=window.location.origin,console.log("Error: "+t+" - "+o))})}else document.getElementById("error-no-jio-no").style.display="block",$("#error-no-jio-no").delay(5e3).fadeOut("slow")}).fail(function(e,t,o){401==e.status?(window.location.href=window.location.origin,console.log("Unauthorized")):(window.location.href=window.location.origin,console.log("Error: "+t+" - "+o))})}),document.querySelector("#submit").addEventListener("click",()=>{var e={url:base_api_endpoint+"log",method:"POST",timeout:0,headers:{"Content-Type":"application/json",Authorization:JWT},data:JSON.stringify({programName:"vip_lounge",flag:"ss_gold_pass_pop_up",sqId:"submit_otp",teamId:userSelectedTeam,platform:"browser",parameters:""})};$.ajax(e).done(function(e){console.log(e)});let t={event:"proceed",page_title:"ss_gold_pass_enter_otp_page",match:userSelectedTeam},o=Object.assign({},dataLayeraddon,t);try{dataLayer.push(o)}catch(a){console.log(a)}let i=document.querySelector(".t1").value,n=document.querySelector(".t2").value,l=document.querySelector(".t3").value,r=document.querySelector(".t4").value,s=document.querySelector(".t5").value,d=document.querySelector(".t6").value;console.log(i+""+n+l+r+s+d);var p,e={url:base_api_endpoint+"login/verifyotp",method:"POST",timeout:0,headers:{"Content-Type":"application/json"},data:JSON.stringify({phoneNo:document.getElementById("user_mobileno").value,phoneNoOTP:i+""+n+l+r+s+d,correlationId:localStorage.getItem("correlationId")})};$.ajax(e).done(function(e){console.log(e),200==e.customCode&&!0==e.success?(isDownload="1",document.getElementById("stepTwo").style.display="none",document.getElementById("mobilePort").style.display="none",document.querySelector("#preview--video").style.opacity="1","share"==currentExperience&&null!=storeBlob&&utilis.shareDownload(storeBlob,selectionType,photoMimeType,vidoMimeType,"share"),"download"==currentExperience&&null!=storeBlob&&("Android"==mobileOS&&("photo"==selectionType&&(document.getElementById("downloadedMsg").innerHTML=downloadMsgAndroidPhoto,showSnackbar()),"video"==selectionType&&(document.getElementById("downloadedMsg").innerHTML=downloadMsgAndroidVideo,showSnackbar())),"iOS"==mobileOS&&("photo"==selectionType&&(document.getElementById("downloadedMsg").innerHTML=downloadMsgiOSPhoto,showSnackbar()),"video"==selectionType&&(document.getElementById("downloadedMsg").innerHTML=downloadMsgiOSVideo,showSnackbar())),utilis.shareDownload(storeBlob,selectionType,photoMimeType,vidoMimeType,"download"))):400==e.customCode&&"INVALIDOTP"==e.message&&(document.getElementById("invalid-otp").style.display="block",$("#invalid-otp").delay(5e3).fadeOut("slow"))}).fail(function(e,t,o){401==e.status?(window.location.href=window.location.origin,console.log("Unauthorized")):(window.location.href=window.location.origin,console.log("Error: "+t+" - "+o))})}),document.querySelector("#resendOTP").addEventListener("click",()=>{let e={event:"resend",page_title:"ss_gold_pass_enter_otp_page",match:userSelectedTeam},t=Object.assign({},dataLayeraddon,e);try{dataLayer.push(t)}catch(o){console.log(o)}var a={url:base_api_endpoint+"log",method:"POST",timeout:0,headers:{"Content-Type":"application/json",Authorization:JWT},data:JSON.stringify({programName:"vip_lounge",flag:"ss_gold_pass_pop_up",sqId:"resend_otp",teamId:userSelectedTeam,platform:"browser",parameters:""})};$.ajax(a).done(function(e){console.log(e)});var a={url:base_api_endpoint+"login/getotp",method:"POST",timeout:0,headers:{"Content-Type":"application/json"},data:JSON.stringify({phoneNo:document.getElementById("user_mobileno").value})};$.ajax(a).done(function(e){console.log(e),200==e.customCode&&!0==e.success?(localStorage.setItem("correlationId",e.correlationId),document.getElementById("success-otp-s2").style.display="block",$("#success-otp-s2").delay(5e3).fadeOut("slow")):400==e.customCode&&(document.getElementById("error-no-jio-exhaust-s2").style.display="block",$("#error-no-jio-exhaust-s2").delay(5e3).fadeOut("slow"))}).fail(function(e,t,o){401==e.status?(window.location.href=window.location.origin,console.log("Unauthorized")):(window.location.href=window.location.origin,console.log("Error: "+t+" - "+o))})}),document.querySelector("#close1").addEventListener("click",()=>{var e={url:base_api_endpoint+"log",method:"POST",timeout:0,headers:{"Content-Type":"application/json",Authorization:JWT},data:JSON.stringify({programName:"vip_lounge",flag:"ss_gold_pass_pop_up",sqId:"close",teamId:userSelectedTeam,platform:"browser",parameters:""})};$.ajax(e).done(function(e){console.log(e)}),document.getElementById("user_mobileno").value="",document.getElementById("mobilePort").style.display="none",document.querySelector("#preview--video").style.opacity="1"}),document.querySelector("#close2").addEventListener("click",()=>{document.getElementById("user_mobileno").value="",document.querySelectorAll(".tseries").value="",document.getElementById("mobilePort").style.display="none",document.querySelector("#preview--video").style.opacity="1"}),$(".otp-verify input:first-child").focus(),$(".otp-verify input").on("input",function(){var e=$(this);e.val().length==e.attr("maxlength")&&e.next(".otp-verify input").focus(),e.is(":last-child")&&e.val().length>0&&document.getElementById("submit").classList.remove("disabled")}),$(".otp-verify input").on("keydown",function(e){var t=$(this);8==e.keyCode&&0==t.val().length&&t.prev(".otp-verify input ").focus(),t.is(":last-child")&&t.val().length>0&&document.getElementById("submit").classList.add("disabled")}),document.getElementById("port").addEventListener("click",()=>{let e={event:"external_link",page_title:"ss_gold_pass_enter_number_page",match:userSelectedTeam},t=Object.assign({},dataLayeraddon,e);try{dataLayer.push(t)}catch(o){console.log(o)}var a={url:base_api_endpoint+"log",method:"POST",timeout:0,headers:{"Content-Type":"application/json",Authorization:JWT},data:JSON.stringify({programName:"vip_lounge",flag:"ss_gold_pass_pop_up",sqId:"get_jio_sim",teamId:userSelectedTeam,platform:"browser",parameters:{item:format}})};$.ajax(a).done(function(e){console.log(e),window.location.href="https://www.jio.com/selfcare/interest/sim/?utm_source="+userSelectedTeam+"&utm_medium=squadselfie"})}),document.getElementById("download--btn").addEventListener("click",()=>{console.log("downloadBtn --> Clicked"),currentExperience="download";let e={event:"select_option",page_title:"squad_selfie_video_generated_page",match:userSelectedTeam,message:"download"},t=Object.assign({},dataLayeraddon,e);try{dataLayer.push(t)}catch(o){console.log(o)}"photo"==selectionType&&(format="image"),"video"==selectionType&&(format="video");var a={url:base_api_endpoint+"log",method:"POST",timeout:0,headers:{"Content-Type":"application/json",Authorization:JWT},data:JSON.stringify({programName:"vip_lounge",flag:"squad_selfie_page",sqId:"downlaod",teamId:userSelectedTeam,platform:"browser",parameters:{item:format}})};if($.ajax(a).done(function(e){console.log(e)}),"0"==isDownload){if(!1==isJioUser){document.getElementById("mobilePort").style.display="block",document.getElementById("stepOne").style.display="block",document.getElementById("stepTwo").style.display="none",document.querySelector("#preview--video").style.opacity="0.1";let i={event:"pageload",page_title:"ss_gold_pass_enter_number_page",match:userSelectedTeam},n=Object.assign({},dataLayeraddon,i);try{dataLayer.push(n)}catch(l){console.log(l)}}else"Android"==mobileOS&&("photo"==selectionType&&(document.getElementById("downloadedMsg").innerHTML=downloadMsgAndroidPhoto,showSnackbar()),"video"==selectionType&&(document.getElementById("downloadedMsg").innerHTML=downloadMsgAndroidVideo,showSnackbar())),"iOS"==mobileOS&&("photo"==selectionType&&(document.getElementById("downloadedMsg").innerHTML=downloadMsgiOSPhoto,showSnackbar()),"video"==selectionType&&(document.getElementById("downloadedMsg").innerHTML=downloadMsgiOSVideo,showSnackbar())),utilis.shareDownload(storeBlob,selectionType,photoMimeType,vidoMimeType,"download")}else{"Android"==mobileOS&&("photo"==selectionType&&(document.getElementById("downloadedMsg").innerHTML=downloadMsgAndroidPhoto,showSnackbar()),"video"==selectionType&&(document.getElementById("downloadedMsg").innerHTML=downloadMsgAndroidVideo,showSnackbar())),"iOS"==mobileOS&&("photo"==selectionType&&(document.getElementById("downloadedMsg").innerHTML=downloadMsgiOSPhoto,showSnackbar()),"video"==selectionType&&(document.getElementById("downloadedMsg").innerHTML=downloadMsgiOSVideo,showSnackbar()));let r={event:"select_option",page_title:"squad_selfie_video_generated_page",match:userSelectedTeam,message:"download"},s=Object.assign({},dataLayeraddon,r);try{dataLayer.push(s)}catch(d){console.log(d)}utilis.shareDownload(storeBlob,selectionType,photoMimeType,vidoMimeType,"download")}})}function SSAddListener(){var e={url:base_api_endpoint+"log",method:"POST",timeout:0,headers:{"Content-Type":"application/json",Authorization:JWT},data:JSON.stringify({programName:"vip_lounge",flag:"squad_selfie_page",sqId:"guidelines_pageload",teamId:userSelectedTeam,platform:"browser",parameters:""})};$.ajax(e).done(function(e){console.log(e)}),selection(),addselectionButtonEventListener(),addCaptureButtonEventListener(),addShareDownloadButtonEventListener(),"Android"==mobileOS&&(document.getElementById("select--video--btn").style.display="none"),document.querySelector("#guidelineS1").addEventListener("click",()=>{}),document.getElementById("camera--switch--back").addEventListener("click",()=>{let e={event:"select_option",page_title:"squad_selfie_source_page",match:userSelectedTeam,message:"rear"},t=Object.assign({},dataLayeraddon,e);try{dataLayer.push(t)}catch(o){console.log(o)}console.log("camera -- switchingBtn --> Clicked");var a={url:base_api_endpoint+"log",method:"POST",timeout:0,headers:{"Content-Type":"application/json",Authorization:JWT},data:JSON.stringify({programName:"vip_lounge",flag:"squad_selfie_page",sqId:"rear_camera",teamId:userSelectedTeam,platform:"browser",parameters:""})};$.ajax(a).done(function(e){console.log(e)}),constraints.video.facingMode="environment",utilis.switchCamera("camera--view",cameraStream,constraints).then(e=>{cameraStream=e},e=>{console.log("Failure"+e)}),document.querySelector("#guidelineS1").style.display="none",document.getElementById("guidelineS2").style.display="block"}),document.getElementById("camera--switch--front").addEventListener("click",()=>{let e={event:"select_option",page_title:"squad_selfie_source_page",match:userSelectedTeam,message:"front"},t=Object.assign({},dataLayeraddon,e);try{dataLayer.push(t)}catch(o){console.log(o)}var a={url:base_api_endpoint+"log",method:"POST",timeout:0,headers:{"Content-Type":"application/json",Authorization:JWT},data:JSON.stringify({programName:"vip_lounge",flag:"squad_selfie_page",sqId:"front_camera",teamId:userSelectedTeam,platform:"browser",parameters:""})};$.ajax(a).done(function(e){console.log(e)}),console.log("camera -- switchingBtnFront --> Clicked"),document.querySelector("#guidelineS1").style.display="none",document.getElementById("guidelineS2").style.display="block"}),document.querySelector(".Proceedbtn").addEventListener("click",()=>{var e={url:base_api_endpoint+"log",method:"POST",timeout:0,headers:{"Content-Type":"application/json",Authorization:JWT},data:JSON.stringify({programName:"vip_lounge",flag:"squad_selfie_page",sqId:"guidelines_proceed",teamId:userSelectedTeam,platform:"browser",parameters:""})};$.ajax(e).done(function(e){console.log(e)}),document.querySelector("#guidelineS2").style.display="none",document.getElementById("show-1").style.display="block";let t={event:"pageload",page_title:"squad_selfie_record_video_page",match:userSelectedTeam},o=Object.assign({},dataLayeraddon,t);try{dataLayer.push(o)}catch(a){console.log(a)}positionIndicator.style.display="block"}),document.getElementById("video--player").addEventListener("ended",()=>{console.log("videoplayer --> Ended"),"video"==selectionType&&stopRecording()}),document.getElementById("video--player").addEventListener("timeupdate",function(){"photo"==selectionType&&!0==imageCaptureFlag&&parseInt(this.currentTime)==imageCaptureTime&&(ssvideoPlayer.pause(),imageCaptureFlag=!1,setTimeout(async function(){utilis.captureSS("camera--view","","selfie--Image","watermark",waterMarkerPosition,constraints,1080,1920,function(e){storeBlob=videoPreView=e,console.log("SS -- image --> Captured"),previewUIupdate()})},50))})}function jsonparser(e){let t=new XMLHttpRequest;t.open("get",e,!0),t.send(),t.onload=function(){if(4==this.readyState&&200==this.status){let e=JSON.parse(this.responseText);for(var t=0;t<e.length;t++)if(e[t].teamName==userSelectedTeam&&e[t].experience==experience){e=e[t];break}if(contentType=e.contentType,utilis.getMediaRecorderSupportType(function(e){vidoMimeType=e,console.log("mediaRecorderSupportType --> "+vidoMimeType)}),"ss"==contentType){let o=utilis.supportsHEVCAlpha()?e.squareSelfie.movVideoUrl??"":e.squareSelfie.webmVideoUrl??"";positionMarkerImageUrl=e.squareSelfie.positionMarkerImageUrl??"",selfieImageUrl=e.squareSelfie.selfieImageUrl??"",console.log(`selfieImageUrl: ${selfieImageUrl}`),waterMarkerImageUrl=e.squareSelfie.waterMarkerImageUrl??"",waterMarkerPosition=e.squareSelfie.waterMarkerPosition??"",console.log(`waterMarkerPosition: ${waterMarkerPosition}`),imageCaptureTime=e.squareSelfie.imageCaptureTime??"0",uIutilis.appRendersquadselfieUI(),utilis.fixDisplayContainer("display--container",!0),utilis.getCamera("camera--view",constraints).then(e=>{cameraStream=e,utilis.downloadVideoStreamBuffer(o,"load--text").then(e=>{videoStreamBufferData=(window.URL||window.webkitURL).createObjectURL(e),(positionIndicator=document.querySelector("#position--indicator")).src=positionMarkerImageUrl,positionIndicator.style.display="none",(selfieImage=document.querySelector("#selfie--Image")).src=selfieImageUrl,(ssvideoPlayer=document.querySelector("#video--player")).src=videoStreamBufferData,(waterMarker=document.querySelector("#watermark")).src=waterMarkerImageUrl,SSAddListener(),document.querySelector("#load--view").style.display="none"})})}}}}async function convertMp4(e){let t=createFFmpeg({log:!0});return new Promise(async(o,a)=>{var i,n=new FileReader;n.onload=function(){i=this.result},n.readAsArrayBuffer(e),await t.load(),t.FS("writeFile","video.webm",new Uint8Array(i)),await t.run("-i","video.webm","output.mp4"),console.log("ffmpeg running");let l=t.FS("readFile","output.mp4");null!=l?o(new File([l.buffer],"test.mp4",{type:"video/mp4"})):a(null)})}function fetchData(){try{if(mobileDetection(),ismobile){var e=new URLSearchParams(window.location.search);JWT=e.get("jwt"),experience=e.get("experience");var t={url:base_api_endpoint+"user/get_profile",method:"GET",timeout:0,headers:{Authorization:JWT}};$.ajax(t).done(function(e){console.log(e),userSelectedTeam=e.selectedTeam,isJioUser=e.isJioUser,jsonparser("./jsons/ss.json");let t={event:"pageload",page_title:"squad_selfie_source_page",match:userSelectedTeam},o=Object.assign({},dataLayeraddon,t);try{dataLayer.push(o)}catch(a){console.log(a)}var i={url:base_api_endpoint+"log",method:"POST",timeout:0,headers:{"Content-Type":"application/json",Authorization:JWT},data:JSON.stringify({programName:"vip_lounge",flag:"squad_selfie_page",sqId:"pageload",teamId:userSelectedTeam,platform:"browser",parameters:""})};$.ajax(i).done(function(e){console.log(e)})}).fail(function(e,t,o){401==e.status?(window.location.href=window.location.origin,console.log("Unauthorized")):(window.location.href=window.location.origin,console.log("Error: "+t+" - "+o))})}else UIdesktopAlert()}catch(o){console.log("err:"+o.message)}}fetchData();